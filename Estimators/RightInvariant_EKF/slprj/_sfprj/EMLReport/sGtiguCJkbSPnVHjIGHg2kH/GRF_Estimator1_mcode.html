<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">GRF</span>, <span class="var type1" id="S3T2U4">contact</span>] = GRF_Estimator(<span class="var type1" id="S4T3U7">q</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Estimates the ground reaction force in the body frame of the robot</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Fe_i = (S_i * J_i^T)^{-1} * S_i * \tau_d</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T4:U4"><span class="var type1" id="S5T4U10">J_pR</span> = <span class="mxinfo " id="T4:U6"><span class="fcn" id="F2N4:B12">J_RightToeBottom</span>(<span class="mxinfo " id="T3:U7">[<span class="mxinfo " id="T5:U8">zeros(<span class="mxinfo " id="T6:U9">6</span>,1)</span>; <span class="mxinfo " id="T7:U10"><span class="var type1" id="S4T3U21">q</span>(7:end)</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T4:U12"><span class="var type1" id="S9T4U28">J_pL</span> = <span class="mxinfo " id="T4:U14"><span class="fcn" id="F3N3:B30">J_LeftToeBottom</span>(<span class="mxinfo " id="T3:U15">[<span class="mxinfo " id="T5:U16">zeros(<span class="mxinfo " id="T6:U17">6</span>,1)</span>; <span class="mxinfo " id="T7:U18"><span class="var type1" id="S4T3U39">q</span>(7:end)</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T6:U20"><span class="var type1" id="S11T6U46">qs_knee_L</span> = <span class="mxinfo " id="T6:U22"><span class="var type1" id="S4T3U48">q</span>(<span class="mxinfo " id="T8:U24">11</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T6:U25"><span class="var type1" id="S12T6U52">qs_tarsus_L</span> = <span class="mxinfo " id="T6:U27"><span class="mxinfo " id="T6:U28"><span class="mxinfo " id="T6:U29"><span class="mxinfo " id="T6:U30"><span class="var type1" id="S4T3U57">q</span>(<span class="mxinfo " id="T8:U32">10</span>)</span> + <span class="mxinfo " id="T6:U33"><span class="var type1" id="S4T3U60">q</span>(<span class="mxinfo " id="T6:U35">11</span>)</span></span> + <span class="mxinfo " id="T6:U36"><span class="var type1" id="S4T3U63">q</span>(<span class="mxinfo " id="T6:U38">12</span>)</span></span> - <span class="mxinfo " id="T6:U39">deg2rad(<span class="mxinfo " id="T6:U40">13</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T6:U41"><span class="var type1" id="S14T6U70">qs_knee_R</span> = <span class="mxinfo " id="T6:U43"><span class="var type1" id="S4T3U72">q</span>(<span class="mxinfo " id="T8:U45">18</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T6:U46"><span class="var type1" id="S15T6U76">qs_tarsus_R</span> = <span class="mxinfo " id="T6:U48"><span class="mxinfo " id="T6:U49"><span class="mxinfo " id="T6:U50"><span class="mxinfo " id="T6:U51"><span class="var type1" id="S4T3U81">q</span>(<span class="mxinfo " id="T8:U53">17</span>)</span> + <span class="mxinfo " id="T6:U54"><span class="var type1" id="S4T3U84">q</span>(<span class="mxinfo " id="T6:U56">18</span>)</span></span> + <span class="mxinfo " id="T6:U57"><span class="var type1" id="S4T3U87">q</span>(<span class="mxinfo " id="T6:U59">19</span>)</span></span> - <span class="mxinfo " id="T6:U60">deg2rad(<span class="mxinfo " id="T6:U61">13</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T2:U62"><span class="var type1" id="S16T2U94">tau_L</span> = <span class="mxinfo " id="T2:U64"><span class="mxinfo " id="T2:U65">-<span class="mxinfo " id="T2:U66">[<span class="mxinfo " id="T6:U67">1500</span>; <span class="mxinfo " id="T6:U68">1250</span>]</span></span>.*<span class="mxinfo " id="T2:U69">[<span class="mxinfo " id="T6:U70"><span class="var type1" id="S11T6U105">qs_knee_L</span> + <span class="var type1" id="S12T6U106">qs_tarsus_L</span></span>; <span class="var type1" id="S12T6U108">qs_tarsus_L</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T2:U74"><span class="var type1" id="S17T2U111">tau_R</span> = <span class="mxinfo " id="T2:U76"><span class="mxinfo " id="T2:U77">-<span class="mxinfo " id="T2:U78">[<span class="mxinfo " id="T6:U79">1500</span>; <span class="mxinfo " id="T6:U80">1250</span>]</span></span>.*<span class="mxinfo " id="T2:U81">[<span class="mxinfo " id="T6:U82"><span class="var type1" id="S14T6U122">qs_knee_R</span> + <span class="var type1" id="S15T6U123">qs_tarsus_R</span></span>; <span class="var type1" id="S15T6U125">qs_tarsus_R</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U86"><span class="var type1" id="S18T2U128">GRF_L</span> = <span class="mxinfo " id="T2:U88"><span class="mxinfo " id="T9:U89">-<span class="mxinfo " id="T9:U90">[<span class="mxinfo " id="T2:U91"><span class="var type1" id="S9T4U134">J_pL</span>(<span class="mxinfo " id="T10:U93">[1,3]</span>,<span class="mxinfo " id="T8:U94">11</span>)</span>, <span class="mxinfo " id="T2:U95"><span class="var type1" id="S9T4U141">J_pL</span>(<span class="mxinfo " id="T10:U97">[1,3]</span>,<span class="mxinfo " id="T8:U98">12</span>)</span>]</span></span> \ <span class="var type1" id="S16T2U147">tau_L</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U100"><span class="var type1" id="S19T2U150">GRF_R</span> = <span class="mxinfo " id="T2:U102"><span class="mxinfo " id="T9:U103">-<span class="mxinfo " id="T9:U104">[<span class="mxinfo " id="T2:U105"><span class="var type1" id="S5T4U156">J_pR</span>(<span class="mxinfo " id="T10:U107">[1,3]</span>,<span class="mxinfo " id="T8:U108">18</span>)</span>, <span class="mxinfo " id="T2:U109"><span class="var type1" id="S5T4U163">J_pR</span>(<span class="mxinfo " id="T10:U111">[1,3]</span>,<span class="mxinfo " id="T8:U112">19</span>)</span>]</span></span> \ <span class="var type1" id="S17T2U169">tau_R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T1:U114"><span class="var type1" id="S2T1U172">GRF</span> = <span class="mxinfo " id="T1:U116">[<span class="var type1" id="S18T2U175">GRF_L</span>; <span class="var type1" id="S19T2U177">GRF_R</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Detect contact using GRF</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T6:U119"><span class="var type1" id="S20T6U180">cL</span> = <span class="mxinfo " id="T6:U121"><span class="fcn" id="F67N7:B182">scaleFactor</span>(<span class="mxinfo " id="T6:U122"><span class="var type1" id="S2T1U184">GRF</span>(<span class="mxinfo " id="T8:U124">2</span>)</span>, <span class="mxinfo " id="T6:U125">50</span>, <span class="mxinfo " id="T6:U126">100</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T6:U127"><span class="var type1" id="S22T6U190">cR</span> = <span class="mxinfo " id="T6:U129"><span class="fcn" id="F67N7:B192">scaleFactor</span>(<span class="mxinfo " id="T6:U130"><span class="var type1" id="S2T1U194">GRF</span>(<span class="mxinfo " id="T8:U132">4</span>)</span>, <span class="mxinfo " id="T6:U133">50</span>, <span class="mxinfo " id="T6:U134">100</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T2:U135"><span class="var type1" id="S3T2U200">contact</span> = <span class="mxinfo " id="T2:U137">[<span class="var type1" id="S20T6U203">cL</span>; <span class="var type1" id="S22T6U205">cR</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
